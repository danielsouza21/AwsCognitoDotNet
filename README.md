# **Project: Integration System with BFF API, API A, and API B**

This project involves the integration of a **BFF API** (Backend for Frontend), which serves as an intermediary between the **user** and **APIs A and B**. The system uses authentication and authorization based on **AWS Cognito** to protect endpoints and manage user access securely.

---

## **Project Architecture**

The system consists of three main APIs:

- **BFF API**: Intermediates requests between the frontend and APIs A and B, centralizing user authentication and token management.
- **API A**: Provides specific business services and integrates directly with the BFF API.
- **API B**: A second API that offers complementary functionalities and is integrated with the BFF API.

### **Application and User Communication Flow**

1. **User Authenticates in AWS Cognito via BFF API**:
   - The user logs in with **username** and **password** through the BFF API.
   - The BFF API uses **AWS Cognito** to authenticate the user and obtain an **Access Token** and **ID Token**.

2. **BFF API Accesses API A**:
   - The BFF API validates the user's token and uses it to communicate with **API A**.
   - **API A** trusts the JWT token validated by **Cognito** to protect its endpoints.

3. **Integration with API B**:
   - **API B** communicates with the **BFF API** in certain cases but does not have direct access to **API A**, ensuring secure separation of responsibilities.

### **Connection Types**:

- **User → BFF API**: The user authenticates and interacts with the BFF API.
- **BFF API → API A**: The BFF API communicates directly with API A using the **Access Token**.
- **BFF API → API B**: The BFF API also communicates with API B for complementary functionalities.

---

## **Authentication and Authorization - AWS Cognito**

**AWS Cognito** is used to manage the authentication and authorization of system users. It provides user management functionalities, multi-factor authentication, and JWT token generation (JSON Web Tokens).

### **Quick Overview of AWS Cognito**:

- **AWS Cognito** is an authentication service managed by AWS that simplifies user management, groups, and access policies.
- It generates **JWT tokens** to authenticate and authorize users across different applications.
- The **Cognito User Pool** stores user information, manages login, email confirmations, and token generation.

---

## **OAuth 2.0 and SRP**

### **OAuth 2.0**:
The project uses **OAuth 2.0** to control authentication between applications, offering a standardized authorization mechanism to grant limited access to services.

- **Client Credentials Flow** is used for authentication between APIs.
- **Resource Owner Password Credentials Flow (ROPC)** and **Secure Remote Password (SRP)** are used to authenticate end users.

### **Secure Remote Password (SRP)**:
**SRP** is a protocol used by Cognito for secure authentication with username and password, without transmitting the password in plain text. After authentication, the user receives JWT tokens to access the APIs.

---

## **JWT Tokens (JSON Web Tokens)**

The project makes use of **JWT Tokens** generated by **AWS Cognito** to authenticate users and protect API endpoints.

### **Types of Tokens**:

- **Access Token**: Used to access protected API resources, containing permissions and scopes.
- **ID Token**: Contains information about the user (claims such as `email`, `name`, etc.).
- **Refresh Token**: Allows renewing tokens without requiring a new login.

---

## **Libraries Used**

- **AWSSDK.Extensions.CognitoAuthentication**: AWS SDK for integrating with Cognito.
- **AWSSDK.CognitoIdentityProvider**: AWS client for communication with Cognito.
- **Swashbuckle.AspNetCore**: Used for documentation and testing with Swagger.
- **System.IdentityModel.Tokens.Jwt**: Used to work with JWT tokens in .NET.

---

### **Project Configuration**

Ensure the following environment variables are correctly set for Cognito to work:

```json
{
  "Aws": {
    "Cognito": {
      "DomainUrl": "https://your-cognito-domain.auth.region.amazoncognito.com",
      "UserPoolId": "your_user_pool_id",
      "ClientId": "your_app_client_id",
      "Region": "your_aws_region"
    }
  }
}
